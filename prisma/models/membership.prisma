/// 会员级别表
model membershipLevels {
    /// 会员级别ID，主键，自增
    id          Int       @id @default(autoincrement())
    /// 级别名称
    name        String    @db.VarChar(50)
    /// 级别描述
    description String?   @db.VarChar(255)
    /// 排序顺序，数字越大级别越高
    sortOrder   Int       @default(0) @map("sort_order")
    /// 状态：1-启用，0-禁用
    status      Int       @default(1)
    /// 创建时间
    createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
    /// 最后更新时间
    updatedAt   DateTime  @default(now()) @map("updated_at") @db.Timestamptz(6)
    /// 删除时间，为NULL表示未删除
    deletedAt   DateTime? @map("deleted_at") @db.Timestamptz(6)

    /// 关联的用户会员记录
    userMemberships    userMemberships[]
    /// 关联的会员权益
    membershipBenefits membershipBenefits[]
    /// 关联的商品
    products           products[]
    /// 关联的兑换码
    redemptionCodes    redemptionCodes[]
    /// 关联的营销活动
    campaigns          campaigns[]

    @@index([sortOrder], map: "idx_membership_levels_sort_order")
    @@index([status], map: "idx_membership_levels_status")
    @@index([deletedAt], map: "idx_membership_levels_deleted_at")
    @@map("membership_levels")
}

/// 用户会员记录表
model userMemberships {
    /// 用户会员记录ID，主键，自增
    id           Int       @id @default(autoincrement())
    /// 用户ID
    userId       Int       @map("user_id")
    /// 会员级别ID
    levelId      Int       @map("level_id")
    /// 开始日期
    startDate    DateTime  @map("start_date") @db.Timestamptz(6)
    /// 到期日期
    endDate      DateTime  @map("end_date") @db.Timestamptz(6)
    /// 是否自动续费
    autoRenew    Boolean   @default(false) @map("auto_renew")
    /// 状态：1-有效，0-无效，2-已结算
    status       Int       @default(1)
    /// 结算时间（会员升级时记录）
    settlementAt DateTime? @map("settlement_at") @db.Timestamptz(6)
    /// 来源类型：1-兑换码，2-直接购买，3-管理员赠送，4-活动奖励，5-试用，6-注册赠送，7-邀请注册赠送，8-会员升级
    sourceType   Int       @map("source_type")
    /// 来源ID，根据来源类型关联到不同的表
    sourceId     Int?      @map("source_id")
    /// 备注
    remark       String?   @db.VarChar(255)
    /// 创建时间
    createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
    /// 最后更新时间
    updatedAt    DateTime  @default(now()) @map("updated_at") @db.Timestamptz(6)
    /// 删除时间，为NULL表示未删除
    deletedAt    DateTime? @map("deleted_at") @db.Timestamptz(6)

    /// 关联的用户
    user                         users                      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    /// 关联的会员级别
    level                        membershipLevels           @relation(fields: [levelId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    /// 关联的积分记录
    pointRecords                 pointRecords[]
    /// 升级前的会员记录
    membershipUpgradeRecordsFrom membershipUpgradeRecords[] @relation("FromMembership")
    /// 升级后的会员记录
    membershipUpgradeRecordsTo   membershipUpgradeRecords[] @relation("ToMembership")

    @@index([userId], map: "idx_user_memberships_user_id")
    @@index([levelId], map: "idx_user_memberships_level_id")
    @@index([status], map: "idx_user_memberships_status")
    @@index([endDate], map: "idx_user_memberships_end_date")
    @@index([deletedAt], map: "idx_user_memberships_deleted_at")
    @@map("user_memberships")
}

/// 权益表
model benefits {
    /// 权益ID，主键，自增
    id              Int       @id @default(autoincrement())
    /// 权益唯一标识码（如 storage_space）
    code            String    @unique @db.VarChar(50)
    /// 权益名称
    name            String    @db.VarChar(100)
    /// 权益描述
    description     String?   @db.VarChar(255)
    /// 单位类型（byte-字节, count-次数）
    unitType        String    @map("unit_type") @db.VarChar(20)
    /// 计算模式（sum-累加, max-取最大值）
    consumptionMode String    @map("consumption_mode") @db.VarChar(20)
    /// 默认值（无会员用户的权益值）
    defaultValue    BigInt    @default(0) @map("default_value")
    /// 状态：1-启用，0-禁用
    status          Int       @default(1)
    /// 创建时间
    createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
    /// 最后更新时间
    updatedAt       DateTime  @default(now()) @map("updated_at") @db.Timestamptz(6)
    /// 删除时间，为NULL表示未删除
    deletedAt       DateTime? @map("deleted_at") @db.Timestamptz(6)

    /// 关联的会员权益
    membershipBenefits membershipBenefits[]
    /// 关联的用户权益
    userBenefits       userBenefits[]

    @@index([code], map: "idx_benefits_code")
    @@index([status], map: "idx_benefits_status")
    @@index([deletedAt], map: "idx_benefits_deleted_at")
    @@map("benefits")
}

/// 会员权益关联表
model membershipBenefits {
    /// 会员权益关联ID，主键，自增
    id           Int       @id @default(autoincrement())
    /// 会员级别ID
    levelId      Int       @map("level_id")
    /// 权益ID
    benefitId    Int       @map("benefit_id")
    /// 权益值
    benefitValue BigInt    @map("benefit_value")
    /// 创建时间
    createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
    /// 最后更新时间
    updatedAt    DateTime  @default(now()) @map("updated_at") @db.Timestamptz(6)
    /// 删除时间，为NULL表示未删除
    deletedAt    DateTime? @map("deleted_at") @db.Timestamptz(6)

    /// 关联的会员级别
    level   membershipLevels @relation(fields: [levelId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    /// 关联的权益
    benefit benefits         @relation(fields: [benefitId], references: [id], onDelete: NoAction, onUpdate: NoAction)

    @@unique([levelId, benefitId])
    @@index([levelId], map: "idx_membership_benefits_level_id")
    @@index([benefitId], map: "idx_membership_benefits_benefit_id")
    @@index([deletedAt], map: "idx_membership_benefits_deleted_at")
    @@map("membership_benefits")
}

/// 用户权益记录表
model userBenefits {
    /// 用户权益记录ID，主键，自增
    id           Int       @id @default(autoincrement())
    /// 用户ID
    userId       Int       @map("user_id")
    /// 权益ID
    benefitId    Int       @map("benefit_id")
    /// 权益值
    benefitValue BigInt    @map("benefit_value")
    /// 来源类型：membership_gift-会员赠送, benefit_package-权益包购买, redemption_code-兑换码, admin_gift-管理员赠送
    sourceType   String    @map("source_type") @db.VarChar(50)
    /// 来源ID（关联到具体的会员记录、订单、兑换码等）
    sourceId     Int?      @map("source_id")
    /// 生效时间
    effectiveAt  DateTime  @map("effective_at") @db.Timestamptz(6)
    /// 过期时间
    expiredAt    DateTime  @map("expired_at") @db.Timestamptz(6)
    /// 状态：1-有效，0-无效
    status       Int       @default(1)
    /// 备注
    remark       String?   @db.VarChar(255)
    /// 创建时间
    createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
    /// 最后更新时间
    updatedAt    DateTime  @default(now()) @map("updated_at") @db.Timestamptz(6)
    /// 删除时间，为NULL表示未删除
    deletedAt    DateTime? @map("deleted_at") @db.Timestamptz(6)

    /// 关联的用户
    user    users    @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    /// 关联的权益
    benefit benefits @relation(fields: [benefitId], references: [id], onDelete: NoAction, onUpdate: NoAction)

    @@index([userId], map: "idx_user_benefits_user_id")
    @@index([benefitId], map: "idx_user_benefits_benefit_id")
    @@index([sourceType], map: "idx_user_benefits_source_type")
    @@index([effectiveAt], map: "idx_user_benefits_effective_at")
    @@index([expiredAt], map: "idx_user_benefits_expired_at")
    @@index([status], map: "idx_user_benefits_status")
    @@index([deletedAt], map: "idx_user_benefits_deleted_at")
    @@map("user_benefits")
}
